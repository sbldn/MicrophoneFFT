/* autogenerated by Processing revision 1293 on 2024-04-24 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import processing.sound.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class MicrophoneFFT extends PApplet {



FFT fft;
AudioIn in;
int bands = 512;
float[] spectrum = new float[bands];
float maxmic = 0;
float offsetX = 1;
float offsetY = 1;


public void setup() {
  /* size commented out by preprocessor */;
  background(0xFF202020);
  fft = new FFT(this, bands);
  in = new AudioIn(this, 1);
  in.start();
  fft.input(in);
  maxmic = 0;
}

public void draw() { 
  background(0xFF202020, 5);
  noStroke();
  fill(0xFF202020, 5);
  rect(0, 0, width, height);
  stroke(255);
    
  fill(255);
  stroke(255);
  translate(width/2, height/2); // Centrar el origen en el centro de la pantalla
  
  fft.analyze(spectrum);
  
  for(int i = 0; i < bands; i++){
    float angle = map(i, 0, bands, 0, TWO_PI); // Mapear el índice del espectro a un ángulo entre 0 y 2*PI
    float radius = map(spectrum[i], 0, 0.1f, 0, 256); // Mapear la amplitud del espectro al radio del punto
    
    float oR = map(noise(offsetX), 0, 1, -1, 1);
    float oA = map(noise(offsetY), 0, 1, -1, 1);
    

    //cartesiano a polares
    float x = radius+oR * cos(angle+oA); 
    float y = radius+oR * sin(angle+oA);
    
    // Dibujar el punto
    stroke(255);
    strokeWeight(3);
    line(0,0,x, y);
   
    // //Circunferencia
    float rad2=100;
    
    float x2 = rad2 * cos(angle); // Convertir de coordenadas polares a cartesianas
    float y2 = rad2 * sin(angle); 
    // line(0,0,x2+x, y2+y);
     point(x2+x,y2+y);
  } 

  // for(int i = 0; i < 360; i++){

  //   float radius = 100;
  //   float x = radius * cos(i); // Convertir de coordenadas polares a cartesianas
  //   float y = radius * sin(i);
  //   // Dibujar el punto
   
  //   point(x,y);
  // } 

 
}


  public void settings() { size(512, 512); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "MicrophoneFFT" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
